# Ventus Fan Controller Configuration
# EMC2305 5-Channel PWM Fan Controller
#
# This is the default configuration template for the Ventus fan controller system.
# Copy this file to ~/.config/ventus/ventus.yaml or /etc/ventus/ventus.yaml and customize.

# =============================================================================
# I2C Bus Configuration
# =============================================================================
i2c:
  # I2C bus number (typically 0 or 1)
  bus: 0

  # Enable cross-process I2C bus locking (recommended)
  lock_enabled: true

  # Lock acquisition timeout in seconds
  lock_timeout: 5.0

  # Directory for lock files
  lock_path: /var/lock

# =============================================================================
# EMC2305 Device Configuration
# =============================================================================
emc2305:
  # Device name (descriptive)
  name: EMC2305 Fan Controller

  # I2C device address (7-bit, hex format)
  # Default: 0x61 (configured by ADDR_SEL resistor on CGW board)
  # Supported addresses: 0x4C, 0x4D, 0x5C, 0x5D, 0x5E, 0x5F
  address: 0x61

  # Enable this device
  enabled: true

  # -----------------------------------------------------------------------------
  # Clock Configuration
  # -----------------------------------------------------------------------------

  # Use external 32.768 kHz crystal for ±0.5% RPM accuracy
  # false = use internal oscillator (±1-2% accuracy)
  # Note: CGW board uses internal oscillator (CLK pin grounded)
  use_external_clock: false

  # -----------------------------------------------------------------------------
  # PWM Configuration
  # -----------------------------------------------------------------------------

  # PWM base frequency in Hz
  # Supported values: 26000, 19531, 4882, 2441
  # Most fans work well with 25kHz (26000)
  pwm_frequency_hz: 26000

  # Invert PWM polarity (rarely needed)
  pwm_polarity_inverted: false

  # Use push-pull output instead of open-drain (rarely needed)
  pwm_output_push_pull: false

  # -----------------------------------------------------------------------------
  # Safety Features
  # -----------------------------------------------------------------------------

  # Enable 4-second watchdog timer
  # Requires periodic communication or device will reset
  enable_watchdog: false

  # Enable ALERT# pin for fault notification
  # Asserts ALERT# on stall, spin failure, or drive failure
  enable_alerts: true

  # -----------------------------------------------------------------------------
  # Fan Channel Configurations (1-5)
  # -----------------------------------------------------------------------------
  fans:
    1:
      name: CPU Fan
      enabled: true

      # Control mode: "pwm" (direct PWM) or "fsc" (closed-loop RPM control)
      control_mode: fsc

      # RPM settings (for FSC mode)
      min_rpm: 1000
      max_rpm: 4500
      default_target_rpm: 3000

      # PWM settings (for PWM mode)
      min_duty_percent: 20
      max_duty_percent: 100
      default_duty_percent: 50

      # Advanced settings
      update_time_ms: 500          # Control loop update time (100-1600)
      edges: 5                     # Tachometer edges (3/5/7/9 for 1/2/3/4-pole fans)
      max_step: 255                # Max PWM change per update (255 = no limit)

      # Spin-up configuration
      spin_up_level_percent: 50    # Drive level during spin-up (30-65)
      spin_up_time_ms: 500         # Spin-up duration (0-1550 in 50ms steps)

      # PID gains (for FSC mode)
      pid_gain_p: 2                # Proportional: 1/2/4/8
      pid_gain_i: 1                # Integral: 0/1/2/4/8/16/32
      pid_gain_d: 1                # Derivative: 0/1/2/4/8/16/32

    2:
      name: Case Fan 1
      enabled: true
      control_mode: pwm

      min_rpm: 500
      max_rpm: 3000
      default_target_rpm: 2000

      min_duty_percent: 30
      max_duty_percent: 100
      default_duty_percent: 40

      update_time_ms: 500
      edges: 5
      max_step: 255

      spin_up_level_percent: 50
      spin_up_time_ms: 500

      pid_gain_p: 2
      pid_gain_i: 1
      pid_gain_d: 1

    3:
      name: Case Fan 2
      enabled: true
      control_mode: pwm

      min_rpm: 500
      max_rpm: 3000
      default_target_rpm: 2000

      min_duty_percent: 30
      max_duty_percent: 100
      default_duty_percent: 40

      update_time_ms: 500
      edges: 5
      max_step: 255

      spin_up_level_percent: 50
      spin_up_time_ms: 500

      pid_gain_p: 2
      pid_gain_i: 1
      pid_gain_d: 1

    4:
      name: Exhaust Fan
      enabled: true
      control_mode: pwm

      min_rpm: 500
      max_rpm: 3000
      default_target_rpm: 2000

      min_duty_percent: 30
      max_duty_percent: 100
      default_duty_percent: 50

      update_time_ms: 500
      edges: 5
      max_step: 255

      spin_up_level_percent: 50
      spin_up_time_ms: 500

      pid_gain_p: 2
      pid_gain_i: 1
      pid_gain_d: 1

    5:
      name: Spare Fan
      enabled: false              # Disabled by default
      control_mode: pwm

      min_rpm: 500
      max_rpm: 3000
      default_target_rpm: 2000

      min_duty_percent: 0
      max_duty_percent: 100
      default_duty_percent: 0

      update_time_ms: 500
      edges: 5
      max_step: 255

      spin_up_level_percent: 50
      spin_up_time_ms: 500

      pid_gain_p: 2
      pid_gain_i: 1
      pid_gain_d: 1

# =============================================================================
# Global Settings
# =============================================================================

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
log_level: INFO

# Optional: Log to file (comment out for console only)
# log_file: /var/log/ventus/ventus.log
